var Market=function(a,b){this.marketId=a.marketId,this.marketName=ko.observable(a.marketName),this.address=ko.observable(a.address),this.schedule=ko.observable(a.schedule),this.products=ko.observable(a.products),this.latitude=ko.observable(a.latitude),this.longitude=ko.observable(a.longitude),this.marker=a.marker},AppViewModel=function(){var a=this;this.US_LAT=37.8,this.US_LNG=-101.5,this.initializeMap=function(){var b={center:new google.maps.LatLng(a.US_LAT,a.US_LNG),mapTypeControl:!1,streetViewControl:!1,zoom:6};a.map=new google.maps.Map(document.getElementById("map"),b)},this.initializeMap(),this.zip=ko.observable(""),this.marketList=ko.observableArray([]),this.marketDataError=ko.observable(""),this.zipError=ko.observable(""),this.currentMarket=ko.observableArray([]),this.numResults=ko.observable(-1),this.marketQuery=ko.observable(""),this.sidebarMaximized=ko.observable(!0),this.bounds=new google.maps.LatLngBounds,this.infowindow=new google.maps.InfoWindow({content:""}),this.filteredMarkets=ko.computed(function(){var b=a.marketQuery().toLowerCase();return ko.utils.arrayFilter(a.marketList(),function(a){return a.marketName().toLowerCase().indexOf(b)>=0})}),this.createMarketItem=function(b){a.marketList.push(new Market(b))},this.setCurrentMarket=function(b){"undefined"!=typeof a.currentMarket().marker&&a.currentMarket().marker.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png"),a.currentMarket(b),b.marker.setIcon("http://maps.google.com/mapfiles/ms/icons/yellow-dot.png"),jQuery(window).width()>768&&a.map.panTo(b.marker.getPosition()),a.openInfoWindow(b.marker)},this.setMapLoc=function(b,c,d){a.map.setCenter({lat:b,lng:c}),a.map.setZoom(d)},this.changeZip=function(){a.zip(""),a.removeMarkers(),a.setMapLoc(a.US_LAT,a.US_LNG,6),a.bounds=new google.maps.LatLngBounds,a.marketList.removeAll(),a.numResults=-1,this.marketQuery(""),a.marketDataError("")},this.addMarker=function(b,c){return marker=new google.maps.Marker({map:a.map,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png",animation:google.maps.Animation.DROP,position:{lat:b,lng:c}}),a.bounds.extend(marker.getPosition()),marker},this.openInfoWindow=function(b){var c=$("#info-window-container").html();a.infowindow.open(a.map,b),a.infowindow.setContent(c),a.sidebarMaximized()&&jQuery(window).width()<=768&&a.toggleSidebar()},this.goToMarkers=function(){a.map.fitBounds(a.bounds)},this.filterMarkers=function(){$.each(a.marketList(),function(b,c){c.marketName().toLowerCase().indexOf(a.marketQuery())>=0?c.marker.setVisible(!0):c.marker.setVisible(!1)})},this.removeMarkers=function(){$.each(a.marketList(),function(a,b){b.marker.setMap(null)})},this.toggleSidebar=function(){a.sidebarMaximized()?a.sidebarMaximized(!1):a.sidebarMaximized(!0)},this.zipDataValid=function(){return 5===a.zip().length&&$.isNumeric(a.zip())?(a.zipError(""),!0):(a.zip(""),!1)},this.resetMarketQuery=function(){a.marketQuery(""),a.filterMarkers()},this.loadMarkets=function(){if(a.marketDataError().length>0&&a.marketDataError(""),a.zipDataValid()){a.numResults=0;var b=$.ajax({url:"http://search.ams.usda.gov/farmersmarkets/v1/data.svc/zipSearch?zip="+a.zip(),dataType:"jsonp",timeout:8e3});b.done(function(b){var c;a.numResults=$(b.results).length,$.each(b.results,function(b,d){c=d.marketname,marketId=d.id,c=c.slice(c.indexOf(" ")+1),a.loadMarketDetails(marketId,c)})}),b.fail(function(){a.marketDataError("Error loading market data. Please try again later.")})}else a.zipError("Invalid zip code entered. Please enter a 5 digit US zip code.")},this.loadMarketDetails=function(b,c){var d=$.ajax({url:"http://search.ams.usda.gov/farmersmarkets/v1/data.svc/mktDetail?id="+b,dataType:"jsonp",timeout:8e3});d.done(function(d){var e=decodeURIComponent(d.marketdetails.GoogleLink),f=$.trim(d.marketdetails.Address.replace(/<br\s*\/?\s*>/g,"\n")),g=$.trim(d.marketdetails.Schedule.replace(/<br\s*\/?\s*>/g,"\n")),h=$.trim(d.marketdetails.Products.replace(/<br\s*\/?\s*>/g,"\n"));g.match(";$")&&(g=g.slice(0,-1)),h=h.replace(/;/g," *");var i=e.slice(e.indexOf("=")+1,e.indexOf(","));i=parseFloat(i);var j=e.slice(e.indexOf(",")+2,e.indexOf("(")-1);j=parseFloat(j);var k=a.addMarker(i,j),l={marketId:b,marketName:c,latitude:i,longitude:j,address:f,schedule:g,products:h,marker:k};a.createMarketItem(l),google.maps.event.addListener(l.marker,"click",function(b){return function(){$.each(a.marketList(),function(c,d){d.marketId===b.marketId&&a.setCurrentMarket(d)})}}(l));var m=$(a.marketList()).length;m===a.numResults&&a.goToMarkers()}),d.fail(function(){a.marketDataError("Error loading market details. Please try again later.")})}},init=function(){ko.applyBindings(new AppViewModel)},mapLoadError=function(){console.log("in mapLoadError"),$map=$("#map"),$map.addClass("error mapError"),$map.html("Farmers Market Finder is unavailable as the map could not be loaded.</p><p>Please try again later.</p>")};
//# sourceMappingURL=app.min.js.map